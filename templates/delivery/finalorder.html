{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    <input type="hidden" id="user_id" value="{{ user.id }}">
    <h1>Final Checkout</h1>
    {% for item in myorder.items.all %}
    <div id = "{{ item.product.id }}">
        <h3>{{ item.product.name }}</h3>
        <h4><input type="text" id='{{ item.product.id }}' value='{{ item.quantity }}'></h4>
        <div class="button" id="inc">+</div>
        <div class="button" id="dec">-</div>
    </div>
    {% endfor %}

</head>
<body>
<div id = "items">

</div>
</body>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function(){

                $(".button").on("click", function() {
                        console.log("In here")

                        var $button = $(this);
                        var oldValue = $button.parent().find("input").val();
                        var id = $('#user_id').val()
                        var item = $button.parent().find("input").attr("id")

                        if ($button.text() == "+") {
                                var newVal = parseFloat(oldValue) + 1;
                        } else {
                        // Don't allow decrementing below zero
                        if (oldValue > 0) {
                        var newVal = parseFloat(oldValue) - 1;
                        } else {
                        newVal = 0;
                        }
                        }
                        var itemdict = JSON.stringify({ "item":item, "quantity":newVal, "id":id})
                        console.log(item)
                        $.ajax({
                        "url" : "/api/update/",
                        "type": "POST",
                        "data":{
                                "item" : itemdict,
                                csrfmiddlewaretoken : "{{ csrf_token }}"
                                },
                        "success" : function(data){
                                if(newVal == 0){
                                        $button.parent("div").hide()
                                }
                                else{
                                        $button.parent().find("input").val(newVal);
                                }

                        },
                        "error" : function(data){
                                console.log("Did not work")
                                console.log(data)
                                }
                        })

                });
    })



</script>
</html>